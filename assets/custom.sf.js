{async function imports(e){return"undefined"!=typeof sf&&void 0!==sf.loader?await sf.loader.mjs(e):Promise.all(e.map((e=>import(e))))}imports.task=function(){return"undefined"!=typeof sf&&void 0!==sf.loader?sf.loader.task:null},window.templates||(window.templates={});var _$_=sf.dom||sf.$,__tmplt=window.templates,_sf_internal=window._sf_internal=window._sf_internal||{body_map:{},_replace(e,t){let n=_$_(t);return this.body_map[e]&&this.body_map[e].remove(),this.reinitViews&&this.reinitViews(n),this.body_map[e]=n},append(e,t){_$_(document.body).append(this._replace.apply(this,arguments))},prepend(e,t){_$_(document.body).prepend(this._replace.apply(this,arguments))}};__tmplt["component/dropdown.sf"]='<drop-down class="dropdown-menu {{hidden}}" style="display: {{visible ? \'block\' : \'none\'}};\r\n    transform: translate({{x | 0}}px, {{y | 0}}px);"><div class="first" style="display: {{!title && \'none\'}}">{{title || \'\'}}</div><ul><li sf-each="x in options" :class="{{x.divider ? \'divider\' : \'\'}} {{x.disabled ? \'disabled\' : \'\'}}" title="{{x.info || \'\'}}">{{@if x.title !== undefined: {[<a>]} if(x.icon !== void 0){ if(x.icon.includes(\'//\')) {[<img class="dropdown-icon" :src="{{x.icon}}">]}; else {[<i class="dropdown-icon {{x.icon}}"></i>]}; } {[<div>{{ x.title }}</div>]} if(x.deep !== void 0) {[<i class="{{ root.icon.more }} has-deep"></i>]}; {[</a>]} }}</li></ul></drop-down>';var DropDown=sf.model("dropdown",(function(e){e.menus=[],e.onCancel=void 0,e.className="",e.pendingDeepOpen=!1,e.pendingDeepOpen_=0,e.icon={more:"fa fa-chevron-right"},e.show=function(o,{x:l,y:a,event:s,element:c,title:d,className:r}){if(e._event=s,0!==e.menus.length?e.menus.splice(0):function(){if(t)return;i.insertBefore(sf.Window.source(e.$el,e._event)),setTimeout((function(){i.addClass("show"),$(sf.Window).on("pointerdown",n),$(sf.Window).once("contextmenu",(e=>e.preventDefault())),t=!0}),10)}(),o.title=d,void 0!==c){let e=c.getBoundingClientRect();o.x=e.x+5,o.y=e.y+e.height}else void 0!==l?(o.x=l,o.y=a):(o.x=s.x,o.y=s.y);o.event=s;for(var p=o.length-1;p>=0;p--)o[p].hide&&o.splice(p,1);return e.className=r||"",e.menus.push(o),e},e.hide=function(){for(var t=0;t<e.menus.length;t++)e.menus.getElement(t).model.deepRemove();e.pendingDeepOpen=!1,e.pendingDeepOpen_=0,e.menus.splice(0),o(),e.className=""};var t=!1;function n(t){$(t.target).parent("sf-m")[0]!==sf.Window.source(e.$el,e._event)&&(o(),e.hide(),e.onCancel&&e.onCancel())}var i=$('<div class="ground-backdrop"></div>');function o(){t=!1,i.removeClass("show"),setTimeout((()=>{i.remove()}),200),$(sf.Window).off("pointerdown",n)}}));sf.component("drop-down",{template:"component/dropdown.sf"},(function(e,t,n){e.visible=!1,e.hidden="hidden",e.options=n,e._parent=n._parent,e.x=n.x,e.y=n.y,e.root=t("dropdown"),e.width=0,e.height=0,e.disabled=!0===n.disabled;for(var i=n.length-1;i>=0;i--)n[i].hide&&n.splice(i,1);var o,l;e.title=n.title,e.init=function(){if(void 0!==n.event){var t=sf.Window.source(e.$el,n.event);if(null===t)return;l=$(t)}else l=e.$el;e.visible=!0;var i=sf.Window.source(e.$el,n.event).querySelector("ul");$.afterRepaint().then((function(){let t=0,n=0,o=e._parent,l=void 0!==o?o.width:0;for(;void 0!==o;)t+=o.x,n+=o.y,o=o._parent;e.width=i.offsetWidth,e.height=i.offsetHeight,t+e.x+e.width>sf.Window.focus.innerWidth&&(e.x-=e.width+l),n+e.y+e.height>sf.Window.focus.innerHeight&&(e.y-=e.height),e.hidden=""}));for(var a=e.options,s=0;s<a.length;s++){let t=a[s];const n=$(a.getElements(s));if(void 0===t.deep)n.on("mouseover",(function(n){e.root.pendingDeepOpen=n.target,clearTimeout(e.root.pendingDeepOpen_),e.root.pendingDeepOpen_=setTimeout((()=>{void 0!==o&&(e.deepRemove(),o=void 0),t.hover&&t.hover.apply(t.context,t.args)}),200)})),t.callback&&n.on("click",(function(n){void 0!==t.unhover&&t.unhover.apply(t.context,t.args),t.callback.apply(t.context,t.args),e.root.hide()})),t.unhover&&n.on("mouseout",(function(e){t.unhover.apply(t.context,t.args)}));else{function c(n){void 0!==o&&e.deepRemove(),void 0!==t.hover&&t.hover.apply(t.context,t.args);var a=t.deep;if(a.event=n,a._parent=e,void 0!==a.el)return o=a.el,a.el.model.y=a.yi-(a.ul?.scrollTop||0),void l.append(a.el);a.ul=e.$el.children("ul")[0],a.x=i.offsetWidth,a.yi=n.target.offsetTop-7,a.y=a.yi-(a.ul?.scrollTop||0),a.el=o=new $DropDown(a,e.$space),o.sf$noGC=!0,l.append(o)}n.on("mouseover",(function(t){e.root.pendingDeepOpen=t.target,clearTimeout(e.root.pendingDeepOpen_),e.root.pendingDeepOpen_=setTimeout((()=>{e.root.pendingDeepOpen===t.target&&c(t)}),200)})),n.on("click",c)}}},e.deepRemove=function(){void 0!==o&&(o.remove(),o.model.deepRemove())}})),__tmplt["component/sketch-panel-bottom.sf"]='<sketch-panel-bottom class="panel {{opened ? \'opened\' : \'\'}}" @contextmenu="SmallNotif.add(\'Some panels still WIP\')"><div class="opener" @click="opened ? closePanel(event) : openPanel()"><i class="fas fa-chevron-{{opened ? \'down\' : \'up\'}}"></i></div><div class="content">This editor still in development (≧▽≦)／<br>I want to make it better and easier to use.<br>Please use right click to open drop down menu for the cable, node, container, or port.</div></sketch-panel-bottom>',sf.component("sketch-panel-bottom",{template:"component/sketch-panel-bottom.sf"},(function(e){function t(){e.$el.css("backdrop-filter","none"),setTimeout((()=>e.$el.css("backdrop-filter","")),300)}e.opened=!1,e.init=function(){e.$el.parent("sketch-page")[0].model.panels.bottom=e},e.openPanel=function(){t(),e.opened=!0},e.closePanel=function(n){t(),n.stopPropagation(),e.opened=!1}})),__tmplt["component/sketch-panel-left.sf"]='<sketch-panel-left class="panel {{opened ? \'opened\' : \'\'}}"><div class="content"><div class="preview" style="height: {{scaledPreviewHeight}}px"><div class="zoom" style="transform: scale({{previewScale}})"><sf-slot for="preview"></sf-slot></div></div><div class="variable-list collapsed"><div class="title" @click="collapseSubPanel(this)">Variables ({{variableCount}})</div><div class="button" @click="createVariable"><i class="fa fa-plus-square"></i></div>\x3c!-- /src/component/tree-list.sf --\x3e<div class="tree-view" tree-section="variables" @pointerdown="checkDragNode"><div class="tree-item collapsed" tree-item-key="{{key}}" sf-each="key, val in variables" style="display: {{val.hidden ? \'none\' : \'\'}}"><div class="title" @click="collapseTree(this)"><i class="fa tree-icon"></i> {{key}}</div>{{@if val.childs != null: @return new $TreeList({ parentKey: \'\', key, val: val.childs, hasChild: varFuncChildCheck }); }}</div></div></div><div class="function-list collapsed"><div class="title" @click="collapseSubPanel(this)">Functions ({{functionCount}})</div><div class="button" @click="createFunction"><i class="fa fa-plus-square"></i></div>\x3c!-- /src/component/tree-list.sf --\x3e<div class="tree-view" tree-section="functions" @pointerdown="checkDragNode"><div class="tree-item collapsed" tree-item-key="{{key}}" sf-each="key, val in functions" style="display: {{val.hidden ? \'none\' : \'\'}}"><div class="title" @click="collapseTree(this)"><i class="fa tree-icon"></i> {{key}}</div>{{@if val.childs != null: @return new $TreeList({ parentKey: \'\', key, val: val.childs, hasChild: varFuncChildCheck }); }}</div></div></div><div class="node-list"><div class="title" @click="collapseSubPanel(this)">Nodes ({{nodeCount}})</div><div class="button" @click="createCustomNode"><i class="fa fa-plus-square"></i></div>\x3c!-- /src/component/tree-list.sf --\x3e<div class="tree-view" tree-section="nodes" @pointerdown="checkDragNode"><div class="tree-item collapsed" sf-each="key, val in nodes" style="display: {{val.hidden ? \'none\' : \'\'}}"><div class="title" @click="collapseTree(this)"><i class="fa tree-icon"></i> {{key}}</div>{{@if val.constructor === Object: @return new $TreeList({parentKey: \'\', key, val}); }}</div></div></div></div><div class="opener" @click="opened ? closePanel(event) : openPanel()"><i class="fas fa-chevron-{{opened ? \'left\' : \'right\'}}"></i></div></sketch-panel-left>',sf.component("sketch-panel-left",{template:"component/sketch-panel-left.sf"},(function(e){let t,n=e.sketch=window.CurrentSketch;function i(e,t){let n=0;if(e.hidden)return n;for(let o in e){let l=e[o];null!=l&&(t?l instanceof Function?n++:n+=i(l,t):null==l.childs?n++:n+=i(l.childs,t))}return e.refresh?.(),n}e.opened=!1,e.preview=null,e.previewWidth=200,e.previewScale=1,e.scaledPreviewHeight=1,e.variables=n.variables,e.functions=n.functions,e.nodes=Blackprint.nodes,e.variableCount=0,e.functionCount=0,e.nodeCount=0;const o=()=>{clearTimeout(t),t=setTimeout((()=>{e.nodeCount=i(Blackprint.availableNode,!0)}),500)};let l;let a;function s(){e.$el.css("backdrop-filter","none"),setTimeout((()=>e.$el.css("backdrop-filter","")),300)}n.on("json.imported",(()=>{clearTimeout(l),l=setTimeout((()=>{e.variableCount=i(n.variables),e.functionCount=i(n.functions)}),500)})),Blackprint.on("moduleAdded",o),Blackprint.on("moduleDelete",o),Blackprint.on("moduleUpdate",o),Blackprint.on("bp_editorNodeAvailability",o),$(o),e.init=function(){e.$el.parent("sketch-page")[0].model.panels.left=e},e.setPreview=function(t){if(null!=t&&e.preview===t||(a?.disconnect(),a=null),e.preview=t,e.previewScale=1,e.scaledPreviewHeight=1,null!=a||null==t)return;let n=0,i=async function(){await $.afterRepaint();let i=t.clientWidth,o=t.clientHeight,l=e.previewWidth/i;n=Math.round(Date.now()/100),e.previewScale=l,e.scaledPreviewHeight=o*l};a=new ResizeObserver((function(e){n!==Math.round(Date.now()/100)&&setTimeout(i,200)})),a.observe(t),setTimeout(i,100)},e.openPanel=function(){s(),e.opened=!0},e.closePanel=function(t){s(),t.stopPropagation(),e.opened=!1},e.collapseTree=function(e){if(null==(e=e.nextElementSibling))return;(e.model.hidden=!e.model.hidden)?$(e.parentNode).addClass("collapsed"):$(e.parentNode).removeClass("collapsed")},e.collapseSubPanel=e=>{$(e).parent().toggleClass("collapsed")},e.checkDragNode=e=>{let t=e.target;if(null!=t.nextElementSibling)return;t=$(t);let i=t.parent(".tree-view").attr("tree-section"),o=t[0].parentNode,l=o.getAttribute("tree-item-key");if(null==l)return;let a=t.parent(".tree-item.has-child > tree-list, .tree-view > .tree-item")[0];null!=a&&(ToolTip.set("Create node"),$(sf.Window).once("pointerup",(e=>{if(ToolTip.set(),null!=e.target.closest("sketch-page")&&null!=e.target.closest("sf-m.cables")){let t=a.model.parentKey+"/"+l;$.afterRepaint().then((function(){let a=e.target.getBoundingClientRect();"nodes"===i?n.createNode(t,{x:e.clientX-a.x,y:e.clientY-a.y}):"functions"===i?o.model.createNode(n,{x:e.clientX-a.x,y:e.clientY-a.y}):"variables"===i&&DropDown.show([{title:"Get "+l,callback(){n.createNode("BP/Var/Get",{data:{name:l},x:e.clientX-a.x,y:e.clientY-a.y})}},{title:"Set "+l,callback(){n.createNode("BP/Var/Set",{data:{name:l},x:e.clientX-a.x,y:e.clientY-a.y})}}],{x:e.clientX,y:e.clientY,event:e})}))}})))},e.createVariable=async e=>{SmallNotif.add("Still under development");let t=await Swal.fire({title:"Variable name",input:"text"});t=t.value,t&&n.createVariable(t)},e.createFunction=async e=>{SmallNotif.add("Still under development");let t=await Swal.fire({title:"Function name",input:"text"});t=t.value,t&&n.createFunction(t,{description:"No description"})},e.createCustomNode=e=>{Modal.goto("/custom-node-editor")},e.varFuncChildCheck=e=>null!=e.childs})),__tmplt["component/sketch-panel-right.sf"]='<sketch-panel-right class="panel {{opened ? \'opened\' : \'\'}} {{nodeSelected == null ? \'hide\' : \'\'}}"><div class="content"><div class="panel-title">Properties</div><div class="bpsprf-default"><div class="field"><span class="name">Title:</span> <span>{{data.title}}</span></div><div class="field"><span class="name" title="Registered node path">Namespace:</span> <span style="font-size:12px">{{data.namespace}}</span></div><div class="field"><span class="name" title="Add an ID so you can easily reference to this node from scripts">Node ID:</span> <input sf-bind="data.id" placeholder="..."></div><div class="field"><span class="name">Comment:</span> <textarea sf-bind="data.comment" placeholder="Add node comment here..."></textarea></div></div><div class="bpsprf-iface"><sf-slot for="ifaceField"></sf-slot></div></div><div class="opener" @click="opened ? closePanel(event) : openPanel()"><i class="fas fa-chevron-{{opened ? \'right\' : \'left\'}}"></i></div></sketch-panel-right>',sf.component("sketch-panel-right",{template:"component/sketch-panel-right.sf"},(function(e){function t(){e.$el.css("backdrop-filter","none"),setTimeout((()=>e.$el.css("backdrop-filter","")),300)}e.opened=!1,e.nodeSelected=null,e.ifaceField=null,e.data={title:"",namespace:"",id:"",v2m$id(t){e.nodeSelected.id=t},comment:"",v2m$comment(t){e.nodeSelected.comment=t}},e.init=function(){e.$el.parent("sketch-page")[0].model.panels.right=e},e.hide=function(){e.nodeSelected=null};let n=!0;e.selectNode=function(t){if(e.nodeSelected=t,e.data.title=t.title,e.data.namespace=t.namespace,e.data.id=t.id||"",e.data.comment=t.comment||"",null==t._bpeditorpanel){let e="bppc-"+t.namespace.toLowerCase().split("/").join("-"),n=Blackprint.space.component(e);if(null!=n.new){let e=n.new.stem(t);t._bpeditorpanel=e}}e.ifaceField=t._bpeditorpanel||null,n&&setTimeout((()=>{n=!1,e.opened=!0}),500)},e.openPanel=function(){t(),e.opened=!0},e.closePanel=function(n){t(),n.stopPropagation(),e.opened=!1}})),__tmplt["component/SmallNotif.sf"]='\x3c!-- /src/component/SmallNotif.sf --\x3e<sf-m name="small.notif"><div class="notify-container right-top"><div sf-each="x in list" class="notify-base notify-{{x.color}}"><span>{{x.message}}</span> <button @click="close(x)" class="close">×</button></div></div></sf-m>';var SmallNotif=sf.model("small.notif",(function(e){const t=sf.$;e.list=[],e.on$list={create(e){t(e).animateKey("fadeInUp")},remove:(e,n)=>(t(e).animateKey("fadeOutUp",n),setTimeout(n,500),!0)},t((function(){0===t('sf-m[name="small.notif"]').length&&t("body").append(t(window.templates["component/SmallNotif.sf"]))})),e.add=function(t,n,i){var o={message:t,color:n||"yellow"};return e.list.push(o),!1!==i&&(o.timer=setTimeout((()=>{e.list.splice(e.list.indexOf(o),1)}),i||1e3+100*t.length)),o},e.close=function(t){e.list.splice(e.list.indexOf(t),1)}}));__tmplt["component/tree-list.sf"]='<tree-list class="tree-list-menu {{hidden ? \'hidden\' : \'\'}}"><div class="tree-item" sf-each="key, val in deep" tree-item-key="{{key}}"><div class="title" @click="collapse(this)"><i class="fa tree-icon"></i> {{key}}</div>{{@if hasChild(val): @return new $TreeList({parentKey: parentKey, key, val}); }}</div></tree-list>',sf.component("tree-list",{template:"component/tree-list.sf"},(function(e,t,n={}){e.parentKey=n.parentKey??"",e.parentKey+=n.key&&""!==e.parentKey?`/${n.key}`:n.key??"",e.deep=n.val??{},e.hidden=!0,e.hasChild=n.hasChild??(e=>e.constructor===Object),e.init=function(){e.$el.parent().addClass("has-child").addClass("collapsed")},e.collapse=function(e){if(null==(e=e.nextElementSibling))return;(e.model.hidden=!e.model.hidden)?$(e.parentNode).addClass("collapsed"):$(e.parentNode).removeClass("collapsed")}})),_sf_internal.append("model/Loading.sf",'\x3c!-- /src/model/loading.sf --\x3e<sf-m name="loading" class="{{showed && \'show\'}}"><span class="icon"><i class="fa fa-fan fa-spin"></i></span> <span class="desc">{{desc}}</span></sf-m>');var Loading=sf.model("loading",(function(e){e.showed=!1,e.desc="",e.set=function(t){t&&!1===e.showed?e.showed=!0:e.showed=!1,e.desc=t}}));_sf_internal.append("model/modal.sf",'\x3c!-- /src/model/modal.sf --\x3e<sf-m name="modal" class="modal {{showed && \'show\'}}"><div class="modal-dialog"><vw-modal></vw-modal></div></sf-m>');var Modal=sf.model("modal",(function(e){e.showed=!1,e.init=e.hotReloaded=function(){e.views=sf.Views.listSelector["vw-modal"]},e.hide=function(){e.showed=!1,e.$el(".modal-dialog").off("pointerdown",e.hide,{outside:!0})},e.goto=function(t){e.views.goto(t),e.showed=!0,setTimeout((()=>{e.$el(".modal-dialog").on("pointerdown",e.hide,{outside:!0})}),400)}}));_sf_internal.append("model/tooltip.sf",'\x3c!-- /src/model/tooltip.sf --\x3e<sf-m name="tooltip" class="{{showed && \'show\'}}" style="transform: translate({{x}}px, {{y}}px);"><div class="desc">{{desc}}</div></sf-m>');var ToolTip=sf.model("tooltip",(function(e){e.showed=!1,e.desc="",e.x=0,e.y=0,e._listener=function(t){e.x=t.clientX,e.y=t.clientY},e.set=function(t,n){null!=n&&(e.x=n.x,e.y=n.y),t&&!1===e.showed?(e.showed=!0,$(window).on("pointermove",e._listener)):(e.showed=!1,$(window).off("pointermove",e._listener)),e.desc=t}}));_sf_internal.append("routes/body.sf",'<div class="background"><div class="img" style="background-image: url(\'/assets/img/background/black3.jpg\')"></div><div class="tile"></div></div>\x3c!-- Model on ./blackprint/header.js --\x3e<sf-m name="header" class="header {{showOptions ? \'sketch-mode\' : \'\'}}"><div class="header-left" @click="mainMenu"><img src="/assets/img/icon/blackprint.png"><div>Blackprint</div><i class="fa fa-caret-down menu-button-hint"></i></div><div class="header-center"><div>A node to node general purpose visual programming</div></div><div class="header-menu"><div class="item-list"><div class="item inactive" @click="SmallNotif.add(\'Please be patient, still work in progress 😅\');" style="color: #2b2b2b" title="Guide/Docs still work in progress"><i class="fa fa-journal-whills"></i></div><div class="item" @click="Modal.goto(\'/module-example-list\')" title="Module examples"><i class="fa fa-map-signs"></i><div class="module-counter">{{_moduleExampleList.length}}</div></div><div class="item" @click="Modal.goto(\'/module-url\')" title="Loaded module"><i class="fa fa-boxes"></i><div class="module-counter">{{_loadedModuleURL.length}}</div></div><div class="item {{cloneActive ? \'active\' : \'\'}}" @click="cloneContainer" title="Show the minimap and open new window"><i class="fa fa-window-restore"></i></div><div class="item {{disableVFXActive ? \'active\' : \'\'}}" @click="disableVFX" title="Improve performance by disable VFX"><i class="fas fa-rocket"></i></div><div class="item {{visualizeActive ? \'active\' : \'\'}}" @click="visualizeFlow" title="Visualize data flow"><i class="fas fa-bezier-curve"></i></div></div><div class="header-zoom"><div style="display: {{info.scale === 100 ? \'none\' : \'block\'}}"><i class="fas fa-search"></i> {{info.scale}}%</div></div></div></sf-m>\x3c!-- Ground viewport --\x3e\x3c!-- ./src/vw-ground/router.js --\x3e<vw-ground style="display: none"></vw-ground><input type="text" id="hidden_text" style="position: fixed; top: 100vh;">\x3c!-- /src/component/dropdown.sf --\x3e<sf-m name="dropdown" class="{{className}}"><drop-down sf-each="val in menus"></drop-down></sf-m>'),sf.model("welcome-text",(function(e){e.toWorkspace=function(){0!==SketchList.length?views.goto("/sketch/1"):e.openExamples()},e.openExamples=function(){Modal.goto("/example-list")}})),sf.model("sketch-pages",(function(e){function t(e,t){let n=e.target.tagName;if("INPUT"===n||"TEXTAREA"===n)return;let i=views.currentPath.match(/\/sketch\/([0-9]+)/)?.[1];if(null==i)return;let o=SketchList[i-1],l=o.scope("container");return t||0!==l.nodeScope.selected.length||0!==l.cableScope.selected.length?{sketch:o,container:l}:void 0}if(e.miniViewer={topRight:null,topRightHidden:!0,on$topRight(t){if(null===t)return e.miniViewer.topRightHidden=!0;e.miniViewer.topRightHidden=!1}},null==e._eventOnce){let n,i;e._eventOnce=!0,$(window).on("keydown",(async e=>{let n=t(e);if(!n)return;let{sketch:i,container:o}=n;if(0!==o.nodeScope.selected.length&&"Delete"===e.key){let e=o.nodeScope.selected;for(let t=0;t<e.length;t++)i.deleteNode(e[t])}})).on("pointermove",(function(e){n=e.clientX,i=e.clientY})).on("copy",(function(e){let n=t(e);if(!n)return;let{sketch:i,container:o}=n;if(0===o.nodeScope.selected.length)return;let l=i.exportJSON({selectedOnly:!0});l=JSON.parse(l);let a=1/0,s=1/0;for(let e in l){if("_"===e)continue;let t=l[e];for(let e=0;e<t.length;e++){let n=t[e];n.x<a&&(a=n.x),n.y<s&&(s=n.y)}}a===1/0&&(a=0),s===1/0&&(s=0);for(let e in l){if("_"===e)continue;let t=l[e];for(let e=0;e<t.length;e++){let n=t[e];n.x-=a,n.y-=s}}e.clipboardData.setData("text/plain",JSON.stringify(l)),e.preventDefault()})).on("paste",(async function(e){let o=t(e,!0);if(!o)return;let{sketch:l,container:a}=o;if(0===a.nodeScope.selected.length)return;let s=e.clipboardData.getData("text/plain");s=JSON.parse(s);let{x:c,y:d}=a.pos,{x:r,y:p}=a.offset;for(let e in s){if("_"===e)continue;let t=s[e];for(let e=0;e<t.length;e++){let o=t[e];o.x+=-c-r+n,o.y+=-d-p+i}}let m=a.nodeScope.list.length;await l.importJSON(s,{appendMode:!0});let{cableScope:u,nodeScope:f}=a;u.selected.forEach((e=>e.selected=!1)),u.selected.splice(0),f.selected.forEach((e=>e._nodeSelected=!1)),f.selected.splice(0),f.selected.push(...f.list.slice(m)),f.selected.forEach((e=>e._nodeSelected=!0))}))}})),sf.model("custom-node-editor",(function(My){My.content="// After execute this, you can test it by connecting\n// Input -> Slider and Logger to this node\n\nlet EventSlot = {slot: 'my-unique'}; // To avoid duplicate listener\n\nBlackprint.registerNode('Test/Hello',\nclass extends Blackprint.Node {\n\tstatic input = { // Port\n\t\t'Give Input': Number\n\t}\n\t\n\tstatic output = { // Port\n\t\tOut: Number\n\t}\n\n\tconstructor(instance){\n\t\tsuper(instance);\n\n\t\t// You can remove this if you want to use default node interface/HTML\n\t\tlet iface = this.setInterface('BPIC/Test/Hello');\n\n\t\tiface.title = 'Add +5';\n\t\tiface.description = 'Add 5 to any number';\n\t}\n});\n\n// You can remove this if you're using default node interface/HTML\nBlackprint.Sketch.registerInterface('BPIC/Test/Hello', {\n\thtml: `\n<div class=\"node {{ type || 'general' }}\" style=\"transform: translate({{ x }}px, {{ y }}px)\">\n  <sf-template path=\"Blackprint/nodes/template/header.sf\"></sf-template>\n\n  <div class=\"content\">\n\t<div class=\"left-port\">\n\t  <sf-template path=\"Blackprint/nodes/template/input-port.sf\"></sf-template>\n\t</div>\n\t\n\t<div style=\"display: inline-block; color: yellow\">\n\t\t{{ log }}\n\t</div>\n    \n\t<div class=\"right-port\">\n\t  <sf-template path=\"Blackprint/nodes/template/output-port.sf\"></sf-template>\n\t</div>\n  </div>\n</div>`\n}, class extends Blackprint.Interface {\n\tconstructor(node){\n\t\tsuper(node);\n\n\t\tthis.log = 0;\n\t}\n\n\t// HTML/Interface Init\n\tinit(el){\n\t\tlet iface = this;\n\t\t\n\t\tconst {\n\t\t\tIInput, IOutput, // Port interface (event, utils, etc)\n\t\t\tInput, Output, // Node Port (get/set value)\n\t\t} = iface.ref;\n\n\t\tIInput['Give Input'].on('value', EventSlot, function({ cable }){\n\t\t\tlet val = cable.value;\n\n\t\t\tiface.log = val + 5; // Give Input -> {{ log }}\n\t\t\tOutput.Out = val + 5; // Give Input -> Out\n\t\t});\n\t}\n\n\t// Run init again to hot reload this node\n\thotReloaded(){\n\t\tthis.init();\n\t}\n\n\t// When this node UI was cloned somewhere\n\t// You can reinit some HTML element if needed\n\tinitClone(el){}\n});",My.init=async function(){void 0===window.monaco&&(await sf.loader.js(["https://cdn.jsdelivr.net/npm/@monaco-editor/loader@1.2.0/lib/umd/monaco-loader.min.js"]),await monaco_loader.init()),My.container=My.$el(".editor"),My.recreate()},My.recreate=function(){void 0!==window.monaco&&(My.editor||(My.editor&&My.editor.dispose(),setTimeout((()=>{let e=My.container.find(".bp-loading-status");My.editor=monaco.editor.create(My.container[0],{value:My.content,language:"javascript",theme:"vs-dark",minimap:{enabled:!1}}),e.css("display","none")}),1e3)))},My.run=function(){eval(My.editor.getValue()),Blackprint.emit("bp_editorNodeAvailability")},My.setValue=function(e){null!=My.editor&&My.editor.setValue(e),My.content=e},My.close=function(){Modal.hide()}})),sf.model("modal-dev-mode",(function(e){e.url=localStorage.BPModuleServer??="",e.placeholder=location.origin,e.connectDefault=function(){localStorage.BPModuleServer=e.url="",e.changeServer()},e.changeServer=async function(t){let n=e.url;n||(n=e.placeholder);let i=n;if("/"===n.slice(-1)&&(n=n.slice(0,-1)),n+="/browser-sync",void 0===window.___browserSync___)try{await sf.loader.js([n+"/browser-sync-client.js?v=2"])}catch(e){return void SmallNotif.add("Failed to load client","red")}___browserSync___.socketUrl=n;let o=___browserSync___.socket;function l(){console.log("Connected to Blackprint module server:",n),SmallNotif.add("Connected to Blackprint module server","green"),localStorage.BPModuleServer=e.url}o.disconnect(),setTimeout((()=>{o.connected||(console.log("Failed to connect to Blackprint module server:",n),SmallNotif.add("Failed to connect to Blackprint module server","red"),o.disconnect(),o.off("connect",l),t&&(localStorage.BPModuleServer=""))}),8e3),o.once("connect",l),o.nsp="/browser-sync",o.io.uri=n,o.connect();let a=!1;try{let e=Object.values(await $.getJSON(i+"/api/module-list"));for(var s=0;s<e.length;s++)e[s]=i+e[s];0!==e.length&&(SmallNotif.add(`Loading ${e.length} new modules`,"yellow"),await Blackprint.loadModuleFromURL(e,{loadBrowserInterface:!0}),SmallNotif.add("New modules have been loaded","green")),a=!0}catch(e){throw SmallNotif.add("Failed to load new modules","red"),e}setTimeout((()=>{a||(SmallNotif.add("Loading modules was taking longer than 10s","red"),0!==sf.loader.pendingResources.size&&console.log("Pending resources:",sf.loader.pendingResources))}),1e4),Modal.showed&&Modal.hide()},""!==e.url&&void 0!==sf.hotReload&&$((()=>setTimeout((()=>e.changeServer(!0)),200)))})),sf.model("environment-variables",(function(e){function t(){$("input",e.list.getElement(e.list.length-1))[0].focus()}e.list=Blackprint.Environment.list,e.newValue="",e.newKey="",e.v2m$newKey=function(n){return 0!==(n=e.validateKey(n)).length&&(Blackprint.Environment.set(n,e.newValue),e.newKey=e.newValue="",t()),""},e.itemChanged=function(i){if(clearTimeout(n),n=setTimeout((function(){let{map:e,list:t}=Blackprint.Environment,n=new Set;for(var i=0;i<t.length;i++){let o=t[i];e[o.key]=o.value,n.add(o.key)}for(let t in e)n.has(t)||Blackprint.Environment.delete(t,!0)}),1e3),0===i.key.length&&(Number.isNaN(i.value)||!i.value))return e.list.splice(e.list.indexOf(i),1),void t()};let n=0;e.validateKey=function(e){return e.replace(/[ \-]+/gm,"_").replace(/\W+/gm,"").replace(/^[0-9]+/gm,"").toUpperCase()},e.close=function(){Modal.hide(),modal.goto("/")}})),sf.model("example-list",(function(e){e.list=[],e.open=function(e){let t=sampleList[e];for(var n=0;n<SketchList.length;n++)SketchList[n].clearNodes();Modal.hide(),(SketchList[0]??=new Blackprint.Sketch).__importing=!0,SketchImporter.pendingLoad=t,SketchImporter.importNow()}})),sf.model("module-example-list-deep",(function(e){e.packageName="",e.baseUrl="",e.list=[],e.openModal=function(t){e.packageName=t.packageName;let n=t.examples;for(var i=0;i<n.length;i++){let e=n[i];e.name||(e.name=e.url.replace("example/","").replace(/^\//,"").replace(".json","").replace(/\-/g," "))}e.list=n,e.baseUrl=t.packageURL},e.openExample=async function(t){SmallNotif.add("Loading information..");let n=t.url;"/"!==n.slice(0,1)&&(n=`/${n}`);let i=await $.getJSON(e.baseUrl+n);SketchImporter.loadJSON(i)},e.back=function(){Modal.goto("/module-example-list")}}));var ModuleExampleList=sf.model("module-example-list",(function(e){e.list=EditorHeader._moduleExampleList,function(){let t=localStorage.bpModuleExampleList;if(!t)return;e.list.push(...JSON.parse(t))}(),e.open=function(e){sf.model("module-example-list-deep").openModal(e),Modal.goto("/module-example-list-deep")},e.add=function(t,n,i){let o=e.list;for(var l=0;l<o.length&&o[l].packageName!==t;l++);if(l===o.length){o.push({packageName:t,packageURL:i,examples:n}),e.list=o=o.sort(((e,t)=>e.packageName.localeCompare(t.packageName)));try{o.refresh()}catch(e){}SmallNotif.add(`"${t}" example has been added`,"green")}else o[l].examples=n;localStorage.bpModuleExampleList=JSON.stringify(e.list)}}));let _editorModuleURL=sf.model("module-url",(function(e){e.list=Blackprint._modulesURL,e.firstInit=!1,e.newURL="";let t=localStorage.bpModuleURLList;async function n(t,n){let i=e.newURL;e.newURL="";let o=SmallNotif.add("Loading","yellow",!1);sf.loader.DOMWasLoaded=!1,sf.loader.onProgress((function(e,t){o.message=`Loading ${e}/${t}`}));try{await Blackprint.loadModuleFromURL(t,n),await sf.loader.task,SmallNotif.add("Module sucessfully loaded","green")}catch(t){SmallNotif.add("Failed to load module","red"),console.error(t),e.newURL=i}finally{sf.loader.DOMWasLoaded=!0}let l=SmallNotif.list;l.splice(l.indexOf(o),1),e.sortURL()}e.init=async function(){},e.sortURL=function(){e.list.sort(((e,t)=>e._url.localeCompare(t._url))),e.list.refresh(),0!==e.list.length&&(localStorage.bpModuleURLList=JSON.stringify(e.list.map((e=>e._url))))},e.shortenLink=function(e,t){if(e=new URL(e),"search"===t)return e.search;if("host"===t)return e.host||location.host;let n=e.pathname;return n.includes("@dist")?n.replace(/(cjs|mjs)\/|\.(min|mjs|js)/g,"").split("/").slice(-2).join("/"):n.replace(/(cjs|mjs|dist)\/|\.(min|mjs|js)/g,"").split("/").slice(-2).join("/")},e.addURL=function(){let t=e.list;for(var i=0;i<t.length;i++){let o=t[i];if(e.newURL===o._url)return;if(e.newURL.replace(/\?.*?$/m,"")===o._url.replace(/\?.*?$/m,""))return o._url=e.newURL.replace(/\?.*?$/m,""),void n(o._url,{loadBrowserInterface:!0})}n(e.newURL.replace(/\?.*?$/m,"")+"?"+(Date.now()/1e3|0),{loadBrowserInterface:!0})},e.reloadURL=function(e){/\?[0-9]/.test(e._url)?e._url=e._url.replace(/\?([0-9]+)/,((e,t)=>"?"+(1+Number(t)))):e._url.includes("?")?e._url=e._url.replace(/\?.*?$/m,"")+"?1":e._url+="?1";for(var t=0;t<SketchList.length;t++)SketchList[t]._remote?.syncModuleList();Blackprint.loadModuleFromURL(e._url)};let{diveModuleURL:i}=Blackprint.utils;e.hideFromURL=function(e){let t=e._url.replace(/\?.*?$/m,""),n=e._hidden=!e._hidden;i(Blackprint.modulesURL[t],(function(e,t,i,o){e[t].hidden=n;for(var l=o.length-1;l>=0;l--){let e=o[l];if(!(--e.val._visibleNode<=0))break;if(0===l){Blackprint.nodes[i[0]].hidden=n;break}o[l-1].val[e.key].hidden=n}})),Blackprint.emit("bp_editorNodeAvailability")},e.deleteFromURL=function(t){if(-1===e.list.indexOf(t))return;let n=t._url.replace(/[?#].*?$/m,"");Blackprint.deleteModuleFromURL(n)},Blackprint.on("moduleDelete",{slot:"bp-editor"},(function({url:t}){let n=document.styleSheets,i=t.replace(/[?#].*?$/m,"").replace(/\.(sf|js|css|min|mjs)\b/g,"");for(var o=0;o<n.length;o++){let e=n[o];if(null!=e.href&&e.href.replace(/[?#].*?$/m,"").replace(/\.(sf|js|css|min|mjs)\b/g,"")===i){e.ownerNode.remove();break}}let l=e.list;for(o=0;o<l.length;o++)if(l[o]._url.includes(i)){l.splice(o,1);break}})),e.npmList=function(){modal.goto("/npm-packages")},e.loadCachedList=function(){let i=t;i&&(i=JSON.parse(i),0!==i.length&&(e.firstInit=!1,n(i,{loadBrowserInterface:!0})))},e.close=function(){Modal.hide(),modal.goto("/")}}));sf.model("npm-package-info",(function(e){let t;async function n(){if(t)return;t=SmallNotif.add("Loading","yellow",!1);let e=setInterval((()=>{!function(e,n){if(e===n)return sf.loader.DOMWasLoaded=!0,t.message=`Loading ${e}/${n}`,void(t=!1);t&&(t.message=`Loading ${e}/${n}`)}(sf.loader.loadedContent,sf.loader.totalContent)}),500);try{await sf.loader.task}catch(e){SmallNotif.add(e.message,"red"),console.error(e)}clearInterval(e);let n=SmallNotif.list;n.splice(n.indexOf(t),1)}e.list=[],e.title="",e.description="",e.version="",e.author="",e.date="",e.repository="",e.packageURL="",e.package=0,e.open=function(t,n,i){e.list=n,e.exampleList=i,e.package=t,e.title=t.name,e.description=t.description||"",e.version=t.version,e.date=t.date.split("T")[0],e.author=t.publisher.username||"",e.repository=t.links.repository||"",e.packageURL=`https://cdn.jsdelivr.net/npm/${t.name}@${t.version}`;let o=Blackprint.modulesURL,l=e.list;for(let e in o)for(var a=0;a<l.length;a++){let t=l[a];e.includes(t.url)&&(t.active="active")}Modal.goto("/npm-package-info")},e.load=async function(t){sf.loader.DOMWasLoaded=!1,setTimeout((()=>{sf.loader.totalContent!==sf.loader.loadedContent&&n()}),500),t.active="loading";try{await Blackprint.loadModuleFromURL([e.packageURL+t.url],{loadBrowserInterface:!0})}finally{sf.loader.totalContent===sf.loader.loadedContent&&(sf.loader.DOMWasLoaded=!0)}0!==e.exampleList.length&&ModuleExampleList.add(e.title,e.exampleList,e.packageURL),t.active="active",e.package._active=!0},e.back=function(){Modal.goto("/npm-packages")}})),sf.model("npm-packages",(function(e){e.list=[],e.search="",e.loading=!1,e.init=function(){e.refreshList()},e.refreshList=async function(){let t="https://registry.npmjs.org/-/v1/search?text=blackprint%20nodes";""!==e.search&&(t+="%20"+e.search),e.loading=!0;let n=(await $.getJSON(t)).objects;e.loading=!1;let i=Blackprint.modulesURL;for(let e in i)for(var o=0;o<n.length;o++){let t=n[o].package;e.includes(t.name)&&(t._active=!0,t._update=Blackprint.utils.packageIsNewer(e,t.name+"@"+t.version))}e.list=n},e.open=async function(t){e.loading=!0;let n=await $.getJSON(`https://data.jsdelivr.com/v1/package/npm/${t.name}@${t.version}`);n=n.files;let i=[],o=[];for(var l=0;l<n.length;l++){let e=n[l];if("directory"===e.type)if("dist"===e.name){let t=e.files;for(var a=0;a<t.length;a++){let e=t[a];if("file"!==e.type)continue;let n=e.name;/\.(map|sf\.mjs|sf\.js|css)$/.test(n)||i.push({url:`/dist/${n}`})}}else if("example"===e.name){let t=e.files;for(a=0;a<t.length;a++){let e=t[a];"file"===e.type&&o.push({url:`/example/${e.name}`})}}}e.loading=!1,sf.model("npm-package-info").open(t,i,o)}})),sf.model("modal-remote-engine-connect",(function(e){e.url=localStorage.BPRemoteEngine??="",e.placeholder="http://localhost:2345",e.allowModuleSync=!0,e.allowRemoteImport=!0,e.allowDataOutSync=!0,e.client=null,e.socket=null,e.connectDefault=function(){localStorage.BPRemoteEngine=e.url="",e.changeServer()};e.changeServer=async function(t){let n=e.url;n||(n=e.placeholder),null==window.io&&await sf.loader.js(["https://cdn.socket.io/4.4.1/socket.io.min.js"]);let i=window.SketchList[0],o=e.client??=new Blackprint.RemoteControl(i);e.client.enable?.(),e.socket?.destroy();let l=e.socket=io(n);l.on("startup-time",(e=>{Date.now()-e<1e4?o.sendSketchToRemote():(o.importRemoteJSON(),o.once("empty.json.import",(function(){o.sendSketchToRemote()})))})),o.on("disabled",(()=>SmallNotif.add("Remote sync was disabled","red"))),o.on("remote-save.begin",(function(){SmallNotif.add("Sketch saved on remote")})),i.disablePorts=!0,o.onImport=t=>e.allowRemoteImport,o.onModule=t=>e.allowModuleSync,l.on("relay",(e=>o.onSyncIn(e))),o.onSyncOut=e=>l.emit("relay",e),Modal.showed&&Modal.hide(),setTimeout((()=>{l.connected||(console.log("Failed to connect to remote engine:",n),SmallNotif.add("Failed to connect to remote engine","red"),l.destroy(),t&&(localStorage.BPRemoteEngine=""))}),8e3),l.on("disconnect",(()=>SmallNotif.add("Disconnected from remote engine"))),l.on("connect",(function(){console.log("Connected to remote engine:",n),SmallNotif.add("Connected to remote engine","green"),localStorage.BPRemoteEngine=n}))},""!==e.url&&null!=Blackprint.RemoteControl&&$((()=>setTimeout((()=>e.changeServer(!0)),200)))})),sf.model("modal-remote-sketch-connect",(function(e){e.url=localStorage.BPSketchRelayServer??="",e.placeholder="http://localhost:2345",e.allowModuleSync=!0,e.allowRemoteImport=!0,e.allowDataOutSync=!0,e.client=null,e.socket=null,e.connectDefault=function(){localStorage.BPSketchRelayServer=e.url="",e.changeServer()},e.changeServer=async function(t){let n=e.url;null==window.io&&await sf.loader.js(["https://cdn.socket.io/4.4.1/socket.io.min.js"]);let i=window.SketchList[0],o=e.client??=new Blackprint.RemoteSketch(i);e.client.enable?.(),o.onImport=t=>e.allowRemoteImport,o.onModule=t=>e.allowModuleSync,o.on("disabled",(()=>SmallNotif.add("Remote sync was disabled","red"))),e.socket?.destroy();let l=e.socket=io(n);l.on("relay",(e=>o.onSyncIn(e))),o.onSyncOut=e=>l.emit("relay",e),setTimeout((()=>{l.connected||(console.log("Failed to connect to sketch's relay server:",n),SmallNotif.add("Failed to connect to sketch's relay server","red"),l.destroy(),t&&(localStorage.BPSketchRelayServer=""))}),8e3),l.on("disconnect",(()=>SmallNotif.add("Disconnected from relay server"))),l.on("connect",(function(){console.log("Connected to sketch's relay server:",n),SmallNotif.add("Connected to sketch's relay server","green"),localStorage.BPSketchRelayServer=n})),Modal.showed&&Modal.hide()},""!==e.url&&null!=Blackprint.RemoteSketch&&$((()=>setTimeout((()=>e.changeServer(!0)),200)))}));var SketchImporter=sf.model("sketch-importer",(function(e){e.modules=[],e.nodes=[],e.pendingLoad=void 0,e.savedKeys={localStorage:[],sessionStorage:[],environmentVariables:[],sketchPages:[]};let t=!1,n=!0;e.loadJSON=async function(t){Modal.goto("/sketch-importer"),t.constructor===String&&(t=JSON.parse(t)),e.pendingLoad=t;let n=t._;e.modules=n&&n.moduleJS||[],e.nodes=[];for(let n in t)"_"!==n&&e.nodes.push({name:n,count:t[n].length});e.checkSavedData()},e.importNow=function(){if(void 0===e.pendingLoad){let e="Please call 'SketchImport.loadJSON' first";return console.error(e),SmallNotif.add(e,"yellow"),!1}Modal.hide();let i=SketchList[0]??=new Blackprint.Sketch;async function o(){sf.loader.DOMWasLoaded=!1,n&&sf.loader.onProgress((function(e,i){t.message=`Loading ${e}/${i}`,n=!0}));try{await i.importJSON(e.pendingLoad)}catch(e){throw SmallNotif.add("Failed to import data","red"),e}finally{sf.loader.DOMWasLoaded=!0,delete i.__importing,e.pendingLoad=void 0}let o=SmallNotif.list;o.splice(o.indexOf(t),1)}if(i.__importing=!0,"/sketch/1"===views.currentPath)return t=SmallNotif.add("Loading","yellow",!1),setTimeout(o,400);views.goto("/sketch/1"),t=SmallNotif.add("Loading","yellow",!1),setTimeout(o,1e3)},e.checkSavedData=function(){e.savedKeys.localStorage=Object.keys(localStorage),e.savedKeys.sessionStorage=Object.keys(sessionStorage),e.savedKeys.environmentVariables=Object.keys(Blackprint.Environment.map),e.savedKeys.sketchPages=SketchList},e.clear={localStorage(){let t=Object.keys(localStorage);for(let e=0;e<t.length;e++)delete localStorage[t[e]];e.savedKeys.localStorage=Object.keys(localStorage)},sessionStorage(){let t=Object.keys(sessionStorage);for(let e=0;e<t.length;e++)delete sessionStorage[t[e]];e.savedKeys.sessionStorage=Object.keys(sessionStorage)},environmentVariables(){let t=Blackprint.Environment,n=Object.keys(t.map);for(let e=0;e<n.length;e++)t.delete(n[e]);e.savedKeys.environmentVariables=Object.keys(Blackprint.Environment.map)},sketchPages(){for(var e=0;e<SketchList.length;e++)SketchList[e].destroy();SketchList.splice(1),views.goto("/sketch/1")}}}));sf.model("sketch-settings",(function(e){e.theme="default",e.on$theme=function(t){$("body").removeClass("node-ui-"+e.theme).addClass("node-ui-"+t)},e.background=localStorage.bpBackgroundURL||"",e.on$background=function(e){$("body > .background > .img").css("background-image","url('"+(e||"/assets/img/background/black3.jpg")+"')").css("background-size","cover"),localStorage.bpBackgroundURL=e},e.hideUnusedPort="true"==localStorage.bpHideUnusedPort||!1,e.on$hideUnusedPort=function(e){for(var t=0;t<SketchList.length;t++){let i=SketchList[t].scope("container");i.hideUnusedPort=e;let o=i.nodeScope.list;for(var n=0;n<o.length;n++)o[n].hideUnusedPort=e}localStorage.bpHideUnusedPort=e},e.background&&e.on$background(e.background)}));var SketchList=[];sf.component("sketch-page",(function(e){let t;if(null==views.data.bpInstance){if(views.data.page.startsWith("node-"))return setTimeout((()=>{e.$el.parent("sf-page-view").remove(),views.lastSibling=null}),500),this.CurrentSketch={_abandon:!0,variables:{},functions:{},on(){}},e.panels={},console.log("Returning to other page because bpInstance was not found");t=e.sketch=SketchList[views.data.page-1]??=new Blackprint.Sketch}else t=e.sketch=views.data.bpInstance;window.CurrentSketch=t,t.page=e,e.panels={left:null,bottom:null,right:null},t._event.$_fallback=BlackprintEventFallback,t.on("port.cable.test",{slot:"bp-editor"},SuggestNodeTypeCaster),t.on("port.hover node.hover",{slot:"bp-editor"},(e=>{e.instance=t,null!=e.port&&PortHoverInfo(e,!0),null!=e.iface&&NodeHoverInfo(e,!0)})),t.on("port.unhover node.unhover",{slot:"bp-editor"},(e=>{e.instance=t,null!=e.port&&PortHoverInfo(e,!1),null!=e.iface&&NodeHoverInfo(e,!1)})),t.on("cable.dropped",{slot:"bp-editor"},(e=>{if(e.event.ctrlKey||!e.afterCreated)return;if(e.event.target.parentNode.model!==t.scope("cables"))return;let n=Blackprint.Sketch.suggestNodeForPort(e.port);i.nodeScope.menu(e.event,n);let o=t.ifaceList,l=o[o.length-1];setTimeout((()=>{$(sf.Window).once("pointerup",(function(){setTimeout((()=>{let t=o[o.length-1];if(l===t)return;let n=e.cable.owner,i=n.source,a=t["input"===i?"output":"input"],s=[];if(null!=a){for(let e in a){if("_list"===e)continue;let t=a[e];isConnectablePort(n.type,t.type)&&s.push(t)}if(1===s.length&&(s[0].connectCable(e.cable),"input"===i)){let t=s[0],n=t.findPortElement(a._list.getElement(t)).getBoundingClientRect(),{offset:i,pos:o,scale:l}=t._scope("container");e.cable.head1[0]=(n.x+n.width/2-i.x-o.x)/l,e.cable.head1[1]=(n.y+n.height/2-i.y-o.y)/l}}}),100)}))}),200)})),t.on("node.function.open",{slot:"bp-editor"},(async e=>{let t=e.iface.namespace.split("/").join("-");t+="-"+e.iface.uniqId,await views.goto("/sketch/node-"+t,{bpInstance:e.iface.bpInstance})})),t.on("node.click",{slot:"bp-editor"},(t=>{e.panels.right.selectNode(t.iface),NodeHoverInfo(t,!1)})),Blackprint.settings("visualizeFlow",!0),e.space??=t.cloneContainer();let n=sf.model("sketch-pages"),i=t.scope("container"),o=sf.model("header");i.hideUnusedPort=sf.model("sketch-settings").hideUnusedPort,i.onScale=function(e){o.info.scale=Math.round(100*e)},e.init=async function(){let t=$(e.space.firstElementChild);t.eq(0).hasClass("bg-tile")||t.prepend('<div class="bg-tile"></div>')},e.importJSON=e=>t.importJSON(e),e.clearNodes=()=>t.clearNodes(),e.cloneActive=!1,e.cloneContainer=function(){if(e.cloneActive=!e.cloneActive,e.cloneActive){!1===e.disableVFXActive&&e.disableVFX();var i,o=t.scope("container");function l(){setTimeout((function(){o.pos.x=-.1,setTimeout((function(){o.pos.x=0}),500)}),1e3)}o.pos.x=0,o.pos.y=0,o.scale=1,o.minimap?i=o.minimap:(i=t.cloneContainer(!0),$('sf-m[name="dropdown"]',i).remove()),new sf.Window({title:"Cloned Sketch Container",templateHTML:t.cloneContainer()},l),n.miniViewer.topRight=i,l()}else n.miniViewer.topRight=null,sf.Window.destroy()},t.on("node.menu",(function({iface:e,menu:t}){t.unshift({title:e.id?"Modify ID":"Add ID",async callback(){let t=await Swal.fire({title:"Write the new ID here",text:e.id?"Current ID: "+e.id:void 0,input:"text"});if(!1===t.isConfirmed)return;let n=SketchList[0],i=t.value;if(""===i)return delete n.iface[e.id],void(e.id=i);if(void 0!==n.iface[i])throw new Error("ID already exist");e.id=i,n.iface[i]=e}},{title:"View source code",async callback(){let t=await utils.openNodeSource(e);t&&(sf.model("custom-node-editor").setValue(t),Modal.goto("/custom-node-editor"))}})}))})),sf.Views._$edit("vw-ground",[{path:"/getting-started",html:"Preparing this file for the future example"},{path:"/",html:'\x3c!-- Filling the default page if haven\'t being routed --\x3e<sf-m name="welcome-text" class="welcome-text"><h1>Welcome to Blackprint Editor!</h1><div class="description">This editor haven\'t being designed for mobile screen.</div><div class="content"><div class="item" @click="toWorkspace"><i class="fas fa-torii-gate"></i> Go to sketch page</div><div class="item" @click="openExamples"><i class="fa fa-map-signs"></i> <span>Open examples</span></div><div class="item" style="cursor: default"><i class="fa fa-book-open"></i> <span style="text-decoration: line-through">Learn from editor</span></div></div><div class="available-engine"><div class="title">Blackprint Engine also available for:</div><div class="list">\x3c!-- python, csharp, java/kotlin, cplusplus, go, rust, docker --\x3e\x3c!-- css3, html5 --\x3e <a class="item" href="https://github.com/Blackprint/engine-js" target="_blank"><img src="/assets/img/icon/denojs.svg"><div class="name">Deno</div></a><a class="item" href="https://github.com/Blackprint/engine-js" target="_blank"><img src="https://cdn.jsdelivr.net/gh/devicons/devicon@v2.14.0/icons/nodejs/nodejs-plain.svg"><div class="name">Node.js</div></a><a class="item" href="https://github.com/Blackprint/engine-php" target="_blank"><img src="https://cdn.jsdelivr.net/gh/devicons/devicon@v2.14.0/icons/php/php-plain.svg"><div class="name">PHP</div></a><a class="item" href="https://github.com/Blackprint/engine-go" target="_blank"><img src="https://cdn.jsdelivr.net/gh/devicons/devicon@2.14.0/icons/go/go-original-wordmark.svg"><div class="name">Golang</div></a></div></div></sf-m><div class="welcome-left"><a target="_blank" href="https://ko-fi.com/stefansarya"><i class="fas fa-mug-hot"></i> Ko-fi </a><a target="_blank" href="https://github.com/Blackprint/Blackprint"><i class="fab fa-github"></i> GitHub </a><a target="_blank" href="https://stefansarya.gitbook.io/blackprint"><i class="fa fa-book-open"></i> Documentation </a><a target="_blank" href="https://github.com/Blackprint/Blackprint/discussions"><i class="fa fa-comments"></i> Discussions</a></div><div class="welcome-right"><a target="_blank" style="cursor: pointer;" onclick="Modal.goto(\'/npm-packages\')">Package List <i class="fas fa-boxes"></i> </a><a target="_blank" href="https://www.npmjs.com/search?q=keywords:blackprint">npm.js <i class="fas fa-box"></i></a></div>'},{path:"/sketch",html:'<sf-m name="sketch-pages">\x3c!-- /src/routes/+vw-ground/sketch.sf --\x3e<vw-page></vw-page><div class="mini-blackprint disable-effect {{miniViewer.topRightHidden && \'hidden\'}}">\x3c!-- Will be replaced with element returned by Blackprint.cloneContainer(true) --\x3e<sf-slot for="miniViewer.topRight"></sf-slot></div></sf-m>',on:{showed(){sf.model("header").showOptions=!0},hidden(){sf.model("header").showOptions=!1}}},{path:"/sketch",html:'<sf-m name="sketch-pages">\x3c!-- /src/routes/+vw-ground/sketch.sf --\x3e<vw-page></vw-page><div class="mini-blackprint disable-effect {{miniViewer.topRightHidden && \'hidden\'}}">\x3c!-- Will be replaced with element returned by Blackprint.cloneContainer(true) --\x3e<sf-slot for="miniViewer.topRight"></sf-slot></div></sf-m>',on:{showed(){sf.model("header").showOptions=!0},hidden(){sf.model("header").showOptions=!1}},"vw-page":[{path:"/:page",html:'<sketch-page>\x3c!-- This element will be replaced with \'My.space\' --\x3e<sf-slot for="space"></sf-slot>\x3c!-- Panels --\x3e<div class="panels">\x3c!-- /src/component/sketch-panel-left.sf --\x3e<sketch-panel-left></sketch-panel-left>\x3c!-- /src/component/sketch-panel-bottom.sf --\x3e<sketch-panel-bottom></sketch-panel-bottom>\x3c!-- /src/component/sketch-panel-right.sf --\x3e<sketch-panel-right></sketch-panel-right></div></sketch-page>',on:{coming(e){console.log("Sketch page data:",e);let t=e.bpInstance??SketchList[e.page-1];null==t||t._abandon||(window.CurrentSketch=t,sf.model("header").cloneActive=t.page.cloneActive,$("body > .background .tile").css("display","none"),0!==t.ifaceList.length||t.__importing||t.page.panels.bottom.openPanel())},leaving(e){console.log("Leaving from sketch page data:",arguments),/^\/sketch\//m.test(e)||($("body > .background .tile").css("display",""),window.CurrentSketch=null)}}}]}]),sf.Views._$edit("vw-modal",[{path:"/",html:"'index.sf' was not found"},{path:"/custom-node-editor",html:'<sf-m name="custom-node-editor"><div class="editor" @keydown.ctrl.enter.prevent="run"><div class="bp-loading-status" style="color: white; padding: 20px">Loading Monaco Editor...</div></div><div class="menu"><div class="item" @click="run" title="Execute (Ctrl + Enter)"><i class="fa fa-play"></i></div>\x3c!-- <div class="item" @click="Modal.hide()" title="Minimize"><i class="fa fa-window-minimize"></i></div> --\x3e<div class="item" @click="close" title="Close"><i class="fa fa-times"></i></div></div></sf-m>',on:{showed(){sf.model("custom-node-editor").recreate()}}},{path:"/dev-mode",html:'<sf-m name="modal-dev-mode"><div class="description">Please set the Blackprint module server URL</div><div class="note" style="display: {{url === \'\' || url === placeholder ? \'none\':\'\'}}" @click="connectDefault">(Click here to connect to default server)</div><div class="text-input"><input placeholder="{{placeholder}}" type="text" sf-bind="url" @keyup.enter="changeServer"></div><div class="button-import" @click="changeServer">Connect</div></sf-m>',on:{coming(){setTimeout((()=>{sf.model("modal-dev-mode").$el("input").focus()}),500)},showed(){setTimeout((()=>{sf.model("modal-dev-mode").$el("input").focus()}),100)}}},{path:"/environment-variables",html:'<sf-m name="environment-variables"><div class="title">Environment Variables</div><div class="head"><div class="row">Key</div><div class="row">Value</div></div><div class="content"><div><div class="row" sf-each="x in list" @keyup="itemChanged(x)"><input class="column key" type="text" @input="(this.value = x.key = validateKey(this.value))" sf-bind="x.key" placeholder="..."> <input class="column" type="text" sf-bind="x.value" placeholder="..."></div></div><div class="row"><input class="column key" type="text" @input="this.value = newKey = validateKey(this.value)" sf-bind="newKey" placeholder="Add new key..."> <input class="column" type="text" sf-bind="newValue" placeholder="..."></div></div><div class="menu"><div class="item" @click="close" title="Close"><i class="fa fa-times"></i></div></div></sf-m>'},{path:"/example-list",html:'<sf-m name="example-list"><div class="description">Please select one of these example (<a href="https://github.com/Blackprint/blackprint.github.io/blob/develop/src/global/sampleList.js">source</a>)</div><div class="list"><div class="item" sf-each="x in list" @click="open(x)">{{x}}</div></div></sf-m>',on:{coming(){sf.model("example-list").list=Object.keys(sampleList)}}},{path:"/module-example-list-deep",html:'<sf-m name="module-example-list-deep"><div class="description">Examples for: <b>{{packageName}}</b></div><div class="list"><div class="item" sf-each="x in list" @click="openExample(x)">{{x.name}}</div></div><div class="menu"><div class="item" @click="back" title="Back"><i class="fa fa-reply"></i></div></div></sf-m>'},{path:"/module-example-list",html:'<sf-m name="module-example-list"><div class="description">Please select one of the module to load the example list</div><div class="list"><div class="item" sf-each="x in list" @click="open(x)">{{x.packageName}}</div></div></sf-m>',on:{coming(){}}},{path:"/module-url",html:'<div style="height:70vh"><sf-m name="module-url"><div class="head"><div class="row url">Shortened Module URL</div><div class="row nodes">Nodes</div><div class="row actions">Actions</div></div><div class="content"><div><div class="row" sf-each="x in list"><div class="column url"><div><b>{{shortenLink(x._url, \'host\')}}</b> {{shortenLink(x._url, \'path\')}} <b>{{shortenLink(x._url, \'search\')}}</b> <a title="Right click to copy link address, click to open on new tab" target="_blank" href="{{x._url}}"><i class="fa fa-link"></i></a></div></div><div class="column nodes">{{x._nodeLength}}</div><div class="column actions"><button title="Show this module on dropdown/module list" @click="hideFromURL(x)"><i class="fa fa-list"></i> <i class="fa fa-slash" style="position: absolute;\r\n\t\t\t\t\t\t\t    margin-left: -15px;\r\n\t\t\t\t\t\t\t    display: {{x._hidden ? \'inline-block\' : \'none\'}}"></i></button> <button title="Reload this module again from URL" @click="reloadURL(x)"><i class="fa fa-sync"></i></button> <button title="Remove any related nodes and also remove this module" @click="deleteFromURL(x)"><i class="fa fa-trash"></i></button></div></div></div><div class="row"><input class="column url-input" type="text" @keyup.enter="addURL()" sf-bind="newURL" placeholder="Add module from URL here... (Then press enter)"></div></div><div class="menu"><div class="item" @click="close" title="Close"><i class="fa fa-times"></i></div><div class="item" @click="npmList" title="Search from NPM"><i class="fa fa-book-open"></i></div><div class="item" @click="loadCachedList" style="{{firstInit ? \'\' : \'display: none\'}}" title="Load cached list"><i class="fa fa-boxes"></i></div></div></sf-m></div>',on:{coming(){_editorModuleURL.sortURL()}}},{path:"/npm-package-info",html:'<sf-m name="npm-package-info"><div class="title">{{title}} (v{{version}})</div><div class="info"><span>{{author}}</span> <a style="display: {{repository ? \'\' : \'none\'}}" href="{{repository}}" target="_blank">(Repository)</a></div><div class="description">{{description}}</div><div class="list-info">Please select module to import:</div><div class="list"><div class="item {{x.active || \'\'}}" sf-each="x in list" @click="load(x)">{{x.url}} <i class="{{x.active === \'loading\' ? \'fa fa-spinner fa-spin\' : \'\'}}"></i></div></div><div class="menu"><div class="item" @click="back" title="Back"><i class="fa fa-reply"></i></div></div></sf-m>'},{path:"/npm-packages",html:'<sf-m name="npm-packages"><div class="description">Search package on NPM repository <i class="{{loading ? \'fa fa-spinner fa-spin\' : \'\'}}"></i></div><div class="mini-description" title="especially if you\'re not a developer, always becareful if someone ask you to do something with Blackprint, like inputting password or private key">Always becareful and verify the module\'s source code before going to production</div><div class="search"><input type="text" sf-bind="search" @keyup.enter="refreshList" placeholder="Search..."></div><div class="list"><div class="item {{x.package._active && \'active\'}} {{x.package._update && \'update\'}}" sf-each="x in list" @click="open(x.package)"><div><div class="title">{{x.package.name}} <span>(v{{x.package.version}})</span></div><div class="author">{{x.package.publisher.username}}</div></div><div><div class="description">{{x.package.description}}</div><div class="date">{{x.package.date.split(\'T\')[0]}}</div></div></div></div></sf-m>'},{path:"/remote-engine-connect",html:'<sf-m name="modal-remote-engine-connect"><div class="description">Please set the remote engine URL</div><div class="note" style="display: {{url === \'\' || url === placeholder ? \'none\':\'\'}}" @click="connectDefault">(Click here to connect to default localhost server)</div><div class="text-input"><input placeholder="{{placeholder}}" type="text" sf-bind="url" @keyup.enter="changeServer"></div><div class="button-import" @click="changeServer">Connect</div></sf-m>',on:{coming(){setTimeout((()=>{sf.model("modal-remote-engine-connect").$el("input").focus()}),500)},showed(){setTimeout((()=>{sf.model("modal-remote-engine-connect").$el("input").focus()}),100)}}},{path:"/remote-sketch-connect",html:'<sf-m name="modal-remote-sketch-connect"><div class="description">Please set the remote sketch\'s relay URL</div><div class="note" style="display: {{url === \'\' || url === placeholder ? \'none\':\'\'}}" @click="connectDefault">(Click here to connect to default localhost server)</div><div class="text-input"><input placeholder="{{placeholder}}" type="text" sf-bind="url" @keyup.enter="changeServer"></div><div class="button-import" @click="changeServer">Connect</div></sf-m>',on:{coming(){setTimeout((()=>{sf.model("modal-remote-sketch-connect").$el("input").focus()}),500)},showed(){setTimeout((()=>{sf.model("modal-remote-sketch-connect").$el("input").focus()}),100)}}},{path:"/sketch-importer",html:'<sf-m name="sketch-importer"><div class="description" title="To avoid any risks if you have stored sensitive data on this editor, make sure you have verify the author of the nodes and the JSON to be imported.">Please verify the author before importing</div><div class="info-modules"><div class="title">These modules will be imported:</div><ul class="list"><li class="item" sf-each="x in modules">{{x}}</li></ul></div><div class="info-nodes"><div class="title">These nodes will be used:</div><ul class="list"><li class="item" sf-each="x in nodes">{{x.name}} ({{x.count}})</li></ul></div><div class="info-clear"><div class="title">Please be careful if you saved sensitive data on this editor<br>You can click below to clear the saved data:</div>\x3c!-- Hi! can you contribute for clearing browser data like WebSQL or IndexedDB? --\x3e<div class="button-clear"><div @click="clear.localStorage">Local Storage ({{savedKeys.localStorage.length}})</div><div @click="clear.sessionStorage">Session Storage ({{savedKeys.sessionStorage.length}})</div><br><div @click="clear.environmentVariables">Environment Variables ({{savedKeys.environmentVariables.length}})</div><div @click="clear.sketchPages">Sketch Pages ({{savedKeys.sketchPages.length}})</div></div></div><div class="button-import" @click="importNow">Import Sketch</div></sf-m>'},{path:"/sketch-settings",html:'<sf-m name="sketch-settings"><div class="description">Settings</div><div class="list"><div class="item"><div class="title">Theme:</div><select sf-bind="theme"><option value="default">Default</option><option value="darker">Darker</option></select></div><div class="item"><div class="title">Background:</div><input type="text" sf-bind="background" placeholder="https://..."></div><div class="item"><div class="title">Hide unused port</div><input type="checkbox" sf-bind="hideUnusedPort"></div></div></sf-m>'}])}
//# sourceMappingURL=custom.sf.js.map